# 开题调研阶段



日期：2024-03-05

姓名：丁孝航宇

## 工作内容：



> 选题调研，调研大语言模型的代码漏洞检测的相关技术背景和技术路线

[大模型在代码缺陷检测领域的应用实践 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/664889273)

[LLbezpeky：利用大型语言模型进行漏洞检测 (windows.net)](https://arxivtools.blob.core.windows.net/xueshuxiangzipaperhtml/2024_1_3/2401.01269.pdf)

- 技术背景：对于代码缺陷检测问题而言，最需解决的关键问题主要有二：

  1.开发成本高效果差。以空指针场景为例，人工编写的规则代码共4439行，需人工维护的回归case共227个，但Q2仍有3个bug漏出

​		2.检测能力差。断链、框架保证非空、复杂场景静态等代码缺陷类型很难识别

​		相比于传统技术而言，大模型的价值正在于解决上述问题

- 技术路线：目标是让计算机像人一样看懂代码，并自动发现代码中的缺陷，给出提示。

  - 核心问题有二：

    - 输入什么内容让机器学习——依托代码知识图谱提取目标变量相关的片段
    - 采取何种方式训练机器提升其能力——采用深度学习的方法，主要包含预训练和微调两部分

  - 代码知识图谱提取片段，代码知识图谱是基于程序分析手段，对业务源代码经过模糊或精准的词法分析、语法分析和语义分析后，结合依赖分析、关系挖掘等手段，构建得到的软件白盒代码知识网。

    - 借助于代码知识图谱能力，可以根据不同场景制定不同的与目标变量或目标场景相关的上下文源码获取能力，提取的关键步骤包括
      - 构建被分析代码的知识图谱
      - 目标变量检测识别：在变更代码中识别目标变量，作为待检测变量
      - 变量依赖分析：基于控制流和数据流的与目标变量相关的依赖变量分析
      - 特征语句提取和剪枝
      - ![image-20240305234544176](C:\Users\22504\AppData\Roaming\Typora\typora-user-images\image-20240305234544176.png)

  - 判别式的大模型学习算法，通过分类的思想，基于模型，从历史的样本中学习规律，从而预测新样本的类别。

    - 案例采取了BERT代码大模型的深度学习算法，

      - 采用BERT进行缺陷检测共含3步，分别是预训练、微调和推理。

        - 预训练阶段采用开源的多语言大模型，已较好的学习多种程序语言的语义。
        - 微调阶段，给模型输入上述通过代码知识图谱提取的变量使用点相关的切片，以及是否有缺陷或者缺陷类型的标签，生成微调模型，让机器具备做检测任务的能力。输入的格式:

        ```text
         {
         "slices": [{"line":"行代码内容", "loc": "行号"}]，
         "mark": {"label":"样本标签", "module_name"："代码库名", "commit_id"："代码版本", "file_path"："文件名", "risk_happend_line"："发生异常的行"}
         }
        ```

        - 推理阶段，分析使用点目标变量的相关切片，通过微调模型进行预测，得到使用点是否有缺陷，以及缺陷类型

      - 完成上述模型后，可采集真实反馈样本（用户对结果的反馈状态，包括误报和接受），加入微调模型自动训练，从而到达自动迭代、快速学习新知识的目的。

  - **生成式的大模型方法**（也即LLM），通过构建prompt(few shot、引入思维链、指定抽象的引导规则)和微调的方式，让程序自动扫描所有相关代码漏洞

    - 第一篇文章实验结果表示模型的稳定性和效果较差，但生成式路线有自身的优势，如参数量大存在智能涌现具有更强的推理能力，允许输入的token量不断增加可减少对切片清洗的依赖，可与修复一起结合等。具体而言，可以通过不断尝试prompt和微调，通过更合适的引导提升生成式方法在检测场景的效果。
    - 第二篇文章给出了一个利用大语言模型进行漏洞检测的实际方法，可以看出如果要做出相应技术成果，如何构造prompt、获取并提供代码相关的提示信息是我们要解决的问题
    - ![image-20240305235708108](C:\Users\22504\AppData\Roaming\Typora\typora-user-images\image-20240305235708108.png)

    

​	

## 遇到的问题:



- 今日遇到的问题：
  - 如果走LLM的技术路线，如何构造prompt、如何提高技术效率、如何发掘创新点、最后要做出什么样态的成果都是我们要解决的问题



## 未来计划：



- 学习了解大语言模型的基础架构及原理
- 继续调研并明确选题和相应的技术路线